install.packages('powerlmm')
knitr::opts_chunk$set(echo = TRUE)
setwd('/Users/syoon1/Dropbox/wtp/study1/analysis')
rm(list=ls())
library(readxl)
library(readr)
library(lme4)
library(tidyverse)
library(ggplot2)
library(jmv)
# read data and preparing the data set
control <- read_csv("wtp1_control.csv")
budget <- read_csv("wtp1_budget.csv")
control <- control %>% select(ResponseId, ends_with("buy_1"), gender, age_1, country) %>% slice(-1:-2)
budget <- budget %>% select(ResponseId, ends_with("buy_1"), gender, age_1, country) %>% slice(-1:-2)
control$group <- "control"
budget$group <- "budget"
data <- bind_rows(control, budget)
colnames(data) <- c('id','self_binder','self_kettle','self_choco','self_corn','self_drug','self_chip','self_juice','self_mug','self_ice','other_binder','other_kettle','other_choco','other_corn','other_drug','other_chip','other_juice','other_mug','other_ice','gender','age','country','group')
data <- data %>% filter(!is.na(self_binder))
data$id <- as.factor(data$id)
data$group <- as.factor(data$group)
data <- data %>% mutate_if(is.character,as.numeric)
data <- data %>% mutate(selfMean = rowMeans(select(., starts_with("self")), na.rm=TRUE))
data <- data %>% mutate(otherMean = rowMeans(select(., starts_with("other")), na.rm=TRUE))
data <- data %>% mutate(gap = otherMean - selfMean)
data %>% filter(self_budget < mean(self_budget))
data %>% filter(self_binder < mean(self_binder))
a<-data %>% filter(self_binder < mean(self_binder))
mean(data$self_binder)
average(data$self_binder)
mean(data$self_binder, na.rm=TRUE)
a<-data %>% filter(self_binder < mean(self_binder, na.rm=TRUE))
a
a <- data %>% filter(self_binder < mean(self_binder, na.rm=TRUE) + 3*sd(self_binder, na.rm=TRUE))
a
data %>% filter(self_binder <= mean(self_binder, na.rm=TRUE) + 3*sd(self_binder, na.rm=TRUE), self_binder >= mean(self_binder, na.rm=TRUE) - 3*sd(self_binder, na.rm=TRUE))
a<-data %>% filter(self_binder <= mean(self_binder, na.rm=TRUE) + 3*sd(self_binder, na.rm=TRUE), self_binder >= mean(self_binder, na.rm=TRUE) - 3*sd(self_binder, na.rm=TRUE))
hist(data$self_binder)
a<-âˆš
a<-data %>% filter(self_binder <= mean(self_binder, na.rm=TRUE) + 3*sd(self_binder, na.rm=TRUE) & self_binder >= mean(self_binder, na.rm=TRUE) - 3*sd(self_binder, na.rm=TRUE))
a
data %>% select(self_binder:other_ice)
a<-data %>% select(self_binder:other_ice)
x <- data$self_binder
mean(x) + 3*sd(x)
x
mean(x, na.rm=TRUE) + 3*sd(x, na.rm=TRUE)
mean(x, na.rm=TRUE) - 3*sd(x, na.rm=TRUE)
upper <- mean(x, na.rm=TRUE) + 3*sd(x, na.rm=TRUE)
bottom <- mean(x, na.rm=TRUE) - 3*sd(x, na.rm=TRUE)
x %>% filter(x <= upper & x >= bottom)
x
upper
bototm
bottom
x %>% filter(x <= upper & x >= bottom)
x
x %>% filter(x <= upper)
x <= upper
x %>% filter(x <= upper & x >= bottom, na.rm=TRUE)
x %>% filter(x <= upper & x >= bottom)
x %>% filter(x <= upper & x >= bottom !is.na(x))
is.na(x)
!is.na(x)
x %>% filter(x <= upper & x >= bottom & !is.na(x))
3sd.out <- function(data) {
upper <- mean(data, na.rm=TRUE) + 3*sd(data, na.rm=TRUE)
bottom <- mean(data, na.rm=TRUE) - 3*sd(data, na.rm=TRUE)
data$out <- ifelse(data > upper | data < bottom, NA, data)
return(x)
}
3sd.out <- function(data) {
upper <- mean(data, na.rm=TRUE) + 3*sd(data, na.rm=TRUE)
bottom <- mean(data, na.rm=TRUE) - 3*sd(data, na.rm=TRUE)
data$out <- ifelse(data > upper | data < bottom, NA, data)
return(x)
}
remove_outliers <- function(dat){
sd <- sd(dat$val)
dat$val_2 <- ifelse(dat$val > 3 * sd, NA, dat$val)
return(dat)
}
3sdout <- function(data) {
upper <- mean(data, na.rm=TRUE) + 3*sd(data, na.rm=TRUE)
bottom <- mean(data, na.rm=TRUE) - 3*sd(data, na.rm=TRUE)
data$out <- ifelse(data > upper | data < bottom, NA, data)
return(x)
}
sdout <- function(data) {
upper <- mean(data, na.rm=TRUE) + 3*sd(data, na.rm=TRUE)
bottom <- mean(data, na.rm=TRUE) - 3*sd(data, na.rm=TRUE)
data$out <- ifelse(data > upper | data < bottom, NA, data)
return(x)
}
sdout(x)
x <- data.frame(x)
sdout(x)
View(x)
sdout <- function(x) {
upper <- mean(x, na.rm=TRUE) + 3*sd(x, na.rm=TRUE)
bottom <- mean(x, na.rm=TRUE) - 3*sd(data, na.rm=TRUE)
x$out <- ifelse(x > upper | x < bottom, NA, x)
return(x)
}
sdout(x)
x
sdout(x$x)
x$x
dat <- as.data.frame(rmvnorm(100, mean = rep(0, 18))) %>%
dat <- as.data.frame(rmvnorm(100, mean = rep(0, 18)))
library(mvtnorm)
dat <- as.data.frame(rmvnorm(100, mean = rep(0, 18)))
dat
View(dat)
dat <- as.data.frame(rmvnorm(100, mean = rep(0, 18))) %>%
mutate(id = row.names(.))
View(dat)
dat <- as.data.frame(rmvnorm(100, mean = rep(0, 18))) %>%
mutate(id = row.names(.)) %>%
gather(var, val, V1:V18)
View(dat)
dat <- as.data.frame(rmvnorm(100, mean = rep(0, 18))) %>%
mutate(id = row.names(.))
View(dat)
dat <- as.data.frame(rmvnorm(100, mean = rep(0, 18))) %>%
mutate(id = row.names(.)) %>%
gather(var, val, V1:V18)
View(dat)
sdout <- function(x) {
upper <- mean(x, na.rm=TRUE) + 3*sd(x, na.rm=TRUE)
bottom <- mean(x, na.rm=TRUE) - 3*sd(data, na.rm=TRUE)
x$out <- ifelse(x > upper | x < bottom, NA, x)
return(x)
}
data %>% select(self_binder:other_ice) %>% filter_at(do(sdout(.)))
data %>% select(self_binder:other_ice) %>% filter_all(do(sdout(.)))
sdout <- function(data) {
upper <- mean(data, na.rm=TRUE) + 3*sd(data, na.rm=TRUE)
bottom <- mean(data, na.rm=TRUE) - 3*sd(data, na.rm=TRUE)
data$out <- ifelse(data > upper | data < bottom, NA, x)
return(data)
}
data %>% select(self_binder:other_ice) %>% filter_all(do(sdout(.)))
sdout <- function(data) {
upper <- mean(data, na.rm=TRUE) + 3*sd(data, na.rm=TRUE)
bottom <- mean(data, na.rm=TRUE) - 3*sd(data, na.rm=TRUE)
data$out <- ifelse(data > upper | data < bottom, NA, x)
return(data)
}
sdout <- function(dat) {
upper <- mean(dat, na.rm=TRUE) + 3*sd(dat, na.rm=TRUE)
bottom <- mean(dat, na.rm=TRUE) - 3*sd(dat, na.rm=TRUE)
data$out <- ifelse(dat > upper | dat < bottom, NA, x)
return(dat)
}
dat <- data %>% gather(item, wtp, self_binder:other_ice)
View(dat)
sdout <- function(dat) {
upper <- mean(dat$wtp, na.rm=TRUE) + 3*sd(dat$wtp, na.rm=TRUE)
bottom <- mean(dat$wtp, na.rm=TRUE) - 3*sd(dat$wtp, na.rm=TRUE)
dat$out <- ifelse(dat$wtp > upper | dat$wtp < bottom, NA, x)
return(dat)
}
dat <- data %>% gather(item, wtp, self_binder:other_ice)
View(dat)
dat <- data %>% gather(item, wtp, self_binder:other_ice) %>% do(sdout(.))
View(dat)
sdout <- function(dat) {
upper <- mean(dat$wtp, na.rm=TRUE) + 3*sd(dat$wtp, na.rm=TRUE)
bottom <- mean(dat$wtp, na.rm=TRUE) - 3*sd(dat$wtp, na.rm=TRUE)
dat$out <- ifelse(dat$wtp > upper | dat$wtp < bottom, NA, dat$wtp)
return(dat)
}
dat <- data %>% gather(item, wtp, self_binder:other_ice) %>% do(sdout(.))
View(dat)
dat_wide <- dat %>% select(-item) %>% spread(item, wtp)
View(dat)
dat_wide <- dat %>% select(-wtp) %>% spread(item, wtp)
dat <- data %>% gather(item, wtp, self_binder:other_ice) %>% do(sdout(.))
dat_wide <- dat %>% select(-wtp) %>% spread(item, wtp)
dat_wide <- dat %>% select(-wtp) %>% spread(item, out)
View(dat_wide)
sdout <- function(dat) {
upper <- mean(dat$wtp, na.rm=TRUE) + 3*sd(dat$wtp, na.rm=TRUE)
bottom <- mean(dat$wtp, na.rm=TRUE) - 3*sd(dat$wtp, na.rm=TRUE)
dat$out <- ifelse(dat$wtp > upper | dat$wtp < bottom, NA, dat$wtp)
return(dat)
}
dat <- data %>% gather(item, wtp, self_binder:other_ice) %>% do(sdout(.))
dat_wide <- dat %>% select(-wtp) %>% spread(item, out)
dat_wide <- dat_wide %>% mutate(selfMean = rowMeans(select(., starts_with("self")), na.rm=TRUE))
dat_wide <- dat_wide %>% mutate(otherMean = rowMeans(select(., starts_with("other")), na.rm=TRUE))
dat_wide <- dat_wide %>% mutate(gap = otherMean - selfMean)
View(dat_wide)
# read data and preparing the data set
control <- read_csv("wtp1_control.csv")
budget <- read_csv("wtp1_budget.csv")
control <- control %>% select(ResponseId, ends_with("buy_1"), gender, age_1, country) %>% slice(-1:-2)
budget <- budget %>% select(ResponseId, ends_with("buy_1"), gender, age_1, country) %>% slice(-1:-2)
control$group <- "control"
budget$group <- "budget"
data <- bind_rows(control, budget)
colnames(data) <- c('id','self_binder','self_kettle','self_choco','self_corn','self_drug','self_chip','self_juice','self_mug','self_ice','other_binder','other_kettle','other_choco','other_corn','other_drug','other_chip','other_juice','other_mug','other_ice','gender','age','country','group')
data <- data %>% filter(!is.na(self_binder))
data$id <- as.factor(data$id)
data$group <- as.factor(data$group)
data <- data %>% mutate_if(is.character,as.numeric)
sdout <- function(dat) {
upper <- mean(dat$wtp, na.rm=TRUE) + 3*sd(dat$wtp, na.rm=TRUE)
bottom <- mean(dat$wtp, na.rm=TRUE) - 3*sd(dat$wtp, na.rm=TRUE)
dat$out <- ifelse(dat$wtp > upper | dat$wtp < bottom, NA, dat$wtp)
return(dat)
}
dat <- data %>% gather(item, wtp, self_binder:other_ice) %>% do(sdout(.))
dat_wide <- dat %>% select(-wtp) %>% spread(item, out)
dat_wide <- dat_wide %>% mutate(selfMean = rowMeans(select(., starts_with("self")), na.rm=TRUE))
dat_wide <- dat_wide %>% mutate(otherMean = rowMeans(select(., starts_with("other")), na.rm=TRUE))
dat_wide <- dat_wide %>% mutate(gap = otherMean - selfMean)
View(data)
dat_wide <- dat_wide %>% mutate(selfMean = rowMeans(select(., starts_with("self")), na.rm=TRUE))
dat_wide <- dat_wide %>% mutate(otherMean = rowMeans(select(., starts_with("other")), na.rm=TRUE))
dat_wide <- dat_wide %>% mutate(gap = otherMean - selfMean)
View(dat_wide)
# t-test
ttestIS(data = data_wide, vars = 'selfMean', group = 'group', effectSize = TRUE, plots=TRUE, desc=TRUE)
ttestIS(data = data_wide, vars = 'gap', group = 'group', effectSize = TRUE, plots=TRUE, desc=TRUE)
# t-test
ttestIS(data = dat_wide, vars = 'selfMean', group = 'group', effectSize = TRUE, plots=TRUE, desc=TRUE)
ttestIS(data = dat_wide, vars = 'otherMean', group = 'group', effectSize = TRUE, plots=TRUE, desc=TRUE)
ttestIS(data = dat_wide, vars = 'gap', group = 'group', effectSize = TRUE, plots=TRUE, desc=TRUE)
jmv::anovaRM(
data = dat_wide,
rm = list(
list(
label="selfOther",
levels=c("Level 1", "Level 2"))),
rmCells = list(
list(
measure="selfMean",
cell="Level 1"),
list(
measure="otherMean",
cell="Level 2")),
bs = "group",
rmTerms = list(
"selfOther"),
bsTerms = list(
"group"),
spherTests = TRUE,
emMeans = list(
NULL))
p <- ggplot(dat_wide, aes(x = group, y = selfMean, fill = group)) + geom_boxplot() + geom_dotplot(binaxis = 'y', stackdir = 'center')
p
data.long <- gather(dat_wide, self_binder:other_ice, key="item", value="WTP")
p <- ggplot(data.long, aes(x = group, y = WTP)) + geom_boxplot() + facet_wrap(~item)
p
data.long <- gather(dat_wide, other_binder:self_mug, key="item", value="WTP")
p <- ggplot(data.long, aes(x = group, y = WTP)) + geom_boxplot() + facet_wrap(~item)
p
sdout <- function(dat) {
upper <- mean(dat$wtp, na.rm=TRUE) + 3*sd(dat$wtp, na.rm=TRUE)
bottom <- mean(dat$wtp, na.rm=TRUE) - 3*sd(dat$wtp, na.rm=TRUE)
dat$out <- ifelse(dat$wtp > upper | dat$wtp < bottom, NA, dat$wtp)
return(dat)
}
dat <- data %>% gather(item, wtp, self_binder:other_ice) %>% group_by(item) %>% do(sdout(.))
dat_wide <- dat %>% select(-wtp) %>% spread(item, out)
dat_wide <- dat_wide %>% mutate(selfMean = rowMeans(select(., starts_with("self")), na.rm=TRUE), otherMean = rowMeans(select(., starts_with("other")), na.rm=TRUE), gap = otherMean - selfMean)
# t-test
ttestIS(data = dat_wide, vars = 'selfMean', group = 'group', effectSize = TRUE, plots=TRUE, desc=TRUE)
ttestIS(data = dat_wide, vars = 'otherMean', group = 'group', effectSize = TRUE, plots=TRUE, desc=TRUE)
ttestIS(data = dat_wide, vars = 'gap', group = 'group', effectSize = TRUE, plots=TRUE, desc=TRUE)
jmv::anovaRM(
data = dat_wide,
rm = list(
list(
label="selfOther",
levels=c("Level 1", "Level 2"))),
rmCells = list(
list(
measure="selfMean",
cell="Level 1"),
list(
measure="otherMean",
cell="Level 2")),
bs = "group",
rmTerms = list(
"selfOther"),
bsTerms = list(
"group"),
spherTests = TRUE,
emMeans = list(
NULL))
p <- ggplot(dat_wide, aes(x = group, y = selfMean, fill = group)) + geom_boxplot() + geom_dotplot(binaxis = 'y', stackdir = 'center')
p
data.long <- gather(dat_wide, other_binder:self_mug, key="item", value="WTP")
p <- ggplot(data.long, aes(x = group, y = WTP)) + geom_boxplot() + facet_wrap(~item)
p
hist(dat_wide$selfMean)
hist(dat_wide$otherMean)
hist(dat_wide$otherMean) + hist(dat_wide$selfMean)
# t-test
dat_wide $>$ filter(country==1) %>% ttestIS(data = dat_wide, vars = 'selfMean', group = 'group', effectSize = TRUE, plots=TRUE, desc=TRUE)
# t-test
dat_wide %>% filter(country==1) %>% ttestIS(data = dat_wide, vars = 'selfMean', group = 'group', effectSize = TRUE, plots=TRUE, desc=TRUE)
# t-test
dat_wide %>% filter(country==1) %>% ttestIS(vars = 'selfMean', group = 'group', effectSize = TRUE, plots=TRUE, desc=TRUE)
dat_wide %>% filter(country==1) %>% ttestIS(vars = 'otherMean', group = 'group', effectSize = TRUE, plots=TRUE, desc=TRUE)
dat_wide %>% filter(country==1) %>% ttestIS(vars = 'gap', group = 'group', effectSize = TRUE, plots=TRUE, desc=TRUE)
dat_wide %>% filter(country==1) %>%
jmv::anovaRM(
rm = list(
list(
label="selfOther",
levels=c("Level 1", "Level 2"))),
rmCells = list(
list(
measure="selfMean",
cell="Level 1"),
list(
measure="otherMean",
cell="Level 2")),
bs = "group",
rmTerms = list(
"selfOther"),
bsTerms = list(
"group"),
spherTests = TRUE,
emMeans = list(
NULL))
dat_wide %>% gather(group, wtp, selfMean, otherMean)
a<- dat_wide %>% gather(group, wtp, selfMean, otherMean)
View(a)
a <- dat_wide %>% select(id, group, selfMean, otherMean) %>% gather(group, wtp, selfMean, otherMean)
a <- dat_wide %>% select(id, group, selfMean, otherMean)
a <- dat_wide %>% select(id, group, selfMean, otherMean) %>% gather(group, wtp, selfMean, otherMean)
dat_wide %>% select(id, group, selfMean, otherMean) %>% gather(group, wtp, selfMean, otherMean) %>% ggplot(aes(x = group, y = wtp, fill = group)) + geom_boxplot() + geom_dotplot(binaxis = 'y', stackdir = 'center')
a <- dat_wide %>% select(id, group, selfMean, otherMean) %>% gather(cond, wtp, selfMean, otherMean)
dat_wide %>% select(id, group, selfMean, otherMean) %>% gather(cond, wtp, selfMean, otherMean) %>% ggplot(aes(x = cond, y = wtp, fill = cond)) + facet_wrap(~group) + geom_boxplot() + geom_dotplot(binaxis = 'y', stackdir = 'center')
dat_wide %>% select(id, group, selfMean, otherMean) %>% gather(cond, wtp, selfMean, otherMean) %>% ggplot(aes(x = cond, y = wtp, fill = cond)) + facet_wrap(~group) + geom_boxplot() + geom_dotplot(binaxis = 'y', stackdir = 'center')
dat_wide %>% select(id, group, selfMean, otherMean) %>% gather(cond, wtp, selfMean, otherMean) %>% ggplot(aes(x = cond, y = wtp, fill = cond)) + facet_wrap(~group) + geom_boxplot() + geom_dotplot(binaxis = 'y', stackdir = 'center')
install.packages("rmarkdown", type="source")
rmarkdown::render_site()
install.packages("rmarkdown", type = "source")
install.packages("rmarkdown", type = "source")
setwd("/syoon1/Documents/personalweb/")
pwd
wd
cwd
setwd("/syoon1/")
setwd("/ssyoon/")
setwd("Users/syoon1/Documents/personalweb/")
setwd("/users/syoon1/Documents/personalweb/")
setwd("/users/syoon1/Documents/personalweb/")
setwd("/users/syoon1/Documents/personalweb/")
rmarkdown::render_site()
setwd("/users/syoon1/Documents/personalweb/ssyoon.github.io")
rmarkdown::render_site()
setwd("/users/syoon1/Documents/personalweb/ssyoon.github.io")
rmarkdown::render_site()
setwd("/users/syoon1/Documents/personalweb/ssyoon.github.io")
rmarkdown::render_site()
setwd("/users/syoon1/Documents/personalweb/ssyoon.github.io")
rmarkdown::render_site()
setwd("/users/syoon1/Documents/personalweb/ssyoon.github.io")
rmarkdown::render_site()
setwd("/users/syoon1/Documents/personalweb/ssyoon.github.io")
rmarkdown::render_site()
setwd("/users/syoon1/Documents/personalweb/ssyoon.github.io")
rmarkdown::render_site()
setwd("/users/syoon1/Documents/personalweb/ssyoon.github.io")
rmarkdown::render_site()
setwd("/users/syoon1/Documents/personalweb/ssyoon.github.io")
rmarkdown::render_site()
setwd("/users/syoon1/Documents/personalweb/ssyoon.github.io")
rmarkdown::render_site()
setwd("/users/syoon1/Documents/personalweb/ssyoon.github.io")
rmarkdown::render_site()
setwd("/users/syoon1/Documents/personalweb/ssyoon.github.io")
rmarkdown::render_site()
setwd("/users/syoon1/Documents/personalweb/ssyoon.github.io")
rmarkdown::render_site()
